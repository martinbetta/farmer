<div class="container">

  <div class="product-container">
  
    
    <div class="img-container" style="background-image: url(<%= @product.image_url %>)">
    </div>

    <div class="info-container">

      <div class="first-row">
        <div class="container-name-stars">
          <h1 class="product-header"><%= @product.name %></h1>
          <%= render "products/rating", avg_score: @product.avg_score %>
        </div>
        <h6><%= @product.user.address %></h6>
      </div>

      <div class="description-container">
        <p><%= @product.description %></p>
      </div>


      <div class="third-row">
        <div class="price-container d-flex">
          <h5>€ <%= @product.unit_price %> x <%= @product.unit %></h5>
        </div>

        <div class="quantity-container">
          <h5><strong>Qty</strong></h5>
          <%= simple_form_for [@product, @order_item], authenticity_token: true, remote: true do |f| %>
            <div class="def-number-input number-input">
              <button onclick="if (this.parentNode.querySelector('input[type=number]').value > 1 ) this.parentNode.querySelector('input[type=number]').stepDown();  return false;" class="minus"></button>
              <%= f.input :quantity, label: false, input_html: { value: 1 } %>
              <button onclick="this.parentNode.querySelector('input[type=number]').stepUp();  return false;" class="plus"></button>
            </div>
            <%= f.button :submit, 'Add to cart', class:"add-to-cart"%>
          <% end %>
        </div>
      </div>

    </div>
    
  </div>

  <ul class="nav nav-tabs justify-content-center" id="myTab" role="tablist">
    <li class="nav-item" role="presentation">
      <a class="nav-link active" id="vendor-tab" data-toggle="tab" href="#vendor" role="tab" aria-controls="vendor" aria-selected="true">Producer</a>
    </li>
    <li class="nav-item" role="presentation">
      <a class="nav-link" id="reviews-tab" data-toggle="tab" href="#reviews" role="tab" aria-controls="reviews" aria-selected="false">Review</a>
    </li>
  </ul>


  <div class="tab-content" id="myTabContent">
    <div class="tab-pane show active" style="margin-top: 20px" id="vendor" role="tabpanel" aria-labelledby="vendor-tab">
      <div class="producer-container d-flex">


        <div class="producer-img-container">
            <%=  image_tag(@vendor.image_url) %>
        </div>

        <div class="vendor-info" style="margin-left: 40px">
          <div class="container-producer-name-rating">
            <h2><%= @vendor.company_name %></h2>
            <%= render "products/rating", avg_score: @vendor.user.avg_score %>
          </div>
          <h6><%= @vendor.description %></h6>
        </div>
        
      </div>
      <!------------------ GEO MAP -------------------->
      <div id="map"
        style="width: 100%; height: 350px;"
        data-markers="<%= @markers.to_json %>"
        data-mapbox-api-key="<%= ENV['MAPBOX_API_KEY'] %>">
      </div>

      <div class="more-products text-center">
        <h1>More from <strong class="color-vendor"><%= @vendor.company_name %></strong></h1>
      </div>

      <div class="col-12 p-0">
        <div class="grid-show">
          <!----------------- Vendor info ----------------->
          <% @vendor.user.products.each do |product| %>
            <%= link_to product_path(product) do %>
              <div class="product-card">
              <div class="product-image" style="background-image: url(<%= product.image_url %>)">
              </div>
              <div class="product-info">
                <div class="name-rate-box">
                  <div class="name-box">
                    <h4 class="bold-title"> <%= product.name %> </h4>
                  </div>
                  <div class="rate-box">
                    <%= render "products/rating", avg_score: product.avg_score %>
                  </div>
                </div>
                <div class="price-unit-cat-box">
                  <h6 class="price-product-index">€ <%= product.unit_price %> / <%= product.unit %> - <%= product.category %></h6>
                </div>
              </div>
            </div>
            <% end %>
          <% end %>
        </div>
      </div>
    </div>

    <div class="tab-pane" id="reviews" role="tabpanel" aria-labelledby="reviews-tab">
      <%= render 'reviews/form'  %>  
      <br>

      <h4>All the reviews</h4>
      <div class="container">
        <div class="row">
          <% @product.reviews.each do |review| %>
            <div class="col-12 col-lg-6">
              <div class="header-rate-box d-flex align-items-center pt-4">
                <p class="m-0 p-0 font-weight-bold"><%= review.user.first_name %> <%= review.user.last_name %> </p>
                <p class="ml-4"> <%= render "products/rating", avg_score: review.rating %></p>
              </div>
              <div class="review-description-box">
                <p> Review: <%= review.content %></p>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div> <!---- closing container ----->
